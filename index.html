<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>MEC Lost & Found</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<style>
:root {
  --bg: #f5f3ef;
  --surface: #fff;
  --border: #e5e1d8;
  --text-primary: #1a1714;
  --text-secondary: #6b655c;
  --accent: #e85d26;
  --accent-hover: #c94d1a;
  --lost: #e85d26;
  --lost-bg: #fff3ee;
  --found: #2a9d6e;
  --found-bg: #edf7f3;
  --resolved: #7c6fcd;
  --resolved-bg: #f3f1fd;
  --match: #d97706;
  --match-bg: #fffbeb;
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.07);
  --shadow-md: 0 4px 20px rgba(0,0,0,0.10);
  --shadow-lg: 0 12px 40px rgba(0,0,0,0.15);
  --radius: 12px; --radius-sm: 8px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text-primary);line-height:1.6;min-height:100vh}
a{color:var(--accent);text-decoration:none}
button{cursor:pointer;font-family:inherit}

/* â”€â”€ NAVBAR â”€â”€ */
.navbar{display:flex;align-items:center;justify-content:space-between;padding:16px 28px;background:var(--surface);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100;box-shadow:var(--shadow-sm)}
.navbar-brand{display:flex;align-items:center;gap:10px;cursor:pointer}
.navbar-title{font-family:'Syne',sans-serif;font-size:1.2rem;font-weight:800;letter-spacing:-.3px}
.nav-right{display:flex;gap:8px;align-items:center}
.back-btn{background:transparent;border:1px solid var(--border);color:var(--text-secondary);padding:8px 16px;border-radius:100px;font-size:.85rem;font-weight:500;transition:all .2s}
.back-btn:hover{border-color:var(--text-primary);color:var(--text-primary)}
.nav-tag{font-size:.75rem;font-weight:700;padding:5px 12px;border-radius:100px;letter-spacing:.3px;text-transform:uppercase}
.nav-tag.found{background:var(--found-bg);color:var(--found);border:1px solid #a8dfc8}
.nav-tag.lost{background:var(--lost-bg);color:var(--lost);border:1px solid #f5c5ae}
.nav-tag.all{background:#f0eef8;color:var(--resolved);border:1px solid #ccc8f0}
.post-btn{background:var(--accent);color:#fff;border:none;padding:10px 20px;border-radius:100px;font-size:.88rem;font-weight:600;transition:background .2s,transform .1s}
.post-btn:hover{background:var(--accent-hover);transform:translateY(-1px)}

/* â”€â”€ PAGES â”€â”€ */
.page{display:none}
.page.active{display:block;animation:fadeUp .3s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}

/* â•â• WELCOME â•â• */
.welcome-wrap{min-height:calc(100vh - 65px);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 24px}
.welcome-badge{background:var(--surface);border:1px solid var(--border);border-radius:100px;padding:6px 18px;font-size:.8rem;font-weight:600;color:var(--text-secondary);letter-spacing:.6px;text-transform:uppercase;margin-bottom:28px}
.welcome-wrap h1{font-family:'Syne',sans-serif;font-size:clamp(2rem,5vw,3.2rem);font-weight:800;text-align:center;letter-spacing:-1px;line-height:1.15;max-width:600px}
.welcome-wrap h1 span{color:var(--accent)}
.welcome-wrap .subtitle{margin-top:14px;color:var(--text-secondary);font-size:1rem;text-align:center;max-width:420px}
.choice-cards{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:48px;width:100%;max-width:620px}
.choice-card{background:var(--surface);border:2px solid var(--border);border-radius:20px;padding:40px 28px 32px;text-align:center;cursor:pointer;transition:transform .22s,box-shadow .22s,border-color .22s;display:flex;flex-direction:column;align-items:center;gap:12px}
.choice-card:hover{transform:translateY(-8px);box-shadow:var(--shadow-md)}
.found-card:hover{border-color:var(--found)}
.lost-card:hover{border-color:var(--lost)}
.choice-icon{width:72px;height:72px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:2rem;margin-bottom:4px}
.found-card .choice-icon{background:var(--found-bg)}
.lost-card .choice-icon{background:var(--lost-bg)}
.choice-card h2{font-family:'Syne',sans-serif;font-size:1.15rem;font-weight:800}
.choice-card p{font-size:.87rem;color:var(--text-secondary);line-height:1.55}
.choice-cta{margin-top:10px;padding:11px 24px;border-radius:100px;border:none;font-size:.87rem;font-weight:600;font-family:inherit;pointer-events:none;transition:background .2s,color .2s}
.found-card .choice-cta{background:var(--found-bg);color:var(--found)}
.found-card:hover .choice-cta{background:var(--found);color:#fff}
.lost-card .choice-cta{background:var(--lost-bg);color:var(--lost)}
.lost-card:hover .choice-cta{background:var(--lost);color:#fff}
.welcome-footer{margin-top:28px;display:flex;gap:20px;flex-wrap:wrap;justify-content:center}
.welcome-footer button{background:none;border:none;color:var(--accent);font-size:.9rem;font-weight:600;text-decoration:underline;padding:0}

/* â•â• SHARED LAYOUT â•â• */
.page-wrap{max-width:1100px;margin:0 auto;padding:0 24px 60px}
.page-hero{border-radius:16px;padding:28px 32px;margin:28px 0 24px;display:flex;align-items:center;gap:18px}
.page-hero.found-hero{background:var(--found-bg);border:1px solid #a8dfc8}
.page-hero.lost-hero{background:var(--lost-bg);border:1px solid #f5c5ae}
.page-hero.all-hero{background:#f0eef8;border:1px solid #ccc8f0}
.hero-icon{font-size:2.6rem;flex-shrink:0}
.page-hero h2{font-family:'Syne',sans-serif;font-size:1.4rem;font-weight:800}
.page-hero.found-hero h2{color:var(--found)}
.page-hero.lost-hero h2{color:var(--lost)}
.page-hero.all-hero h2{color:var(--resolved)}
.page-hero p{margin-top:3px;font-size:.92rem;opacity:.8}

/* â•â• SEARCH BAR â•â• */
.search-bar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:24px;padding:14px 18px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow-sm)}
.search-input-wrap{display:flex;align-items:center;flex:1;min-width:200px;background:var(--bg);border:1px solid var(--border);border-radius:var(--radius-sm);padding:0 14px;transition:border-color .2s}
.search-input-wrap:focus-within{border-color:var(--accent)}
.si{opacity:.5;margin-right:8px}
.search-input{flex:1;border:none;background:transparent;padding:9px 0;font-size:.93rem;font-family:inherit;color:var(--text-primary);outline:none}
.search-input::placeholder{color:var(--text-secondary)}
.filter-select{border:1px solid var(--border);border-radius:var(--radius-sm);padding:9px 12px;font-size:.88rem;font-family:inherit;background:var(--bg);color:var(--text-primary);outline:none}
.status-pills{display:flex;gap:6px}
.spill{padding:8px 16px;border-radius:100px;border:1px solid var(--border);background:transparent;font-size:.82rem;font-weight:500;color:var(--text-secondary);transition:all .2s}
.spill:hover{border-color:var(--accent);color:var(--accent)}
.spill.active{background:var(--accent);border-color:var(--accent);color:#fff}

/* â•â• SECTION LABEL â•â• */
.section-label{font-family:'Syne',sans-serif;font-size:1.05rem;font-weight:700;margin-bottom:14px;display:flex;align-items:center;gap:8px}
.count-badge{font-size:.8rem;color:var(--text-secondary);font-weight:400}

/* â•â• GRID & CARDS â•â• */
.items-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(278px,1fr));gap:18px}
.item-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow-sm);transition:transform .2s,box-shadow .2s;position:relative;display:flex;flex-direction:column}
.item-card:hover{transform:translateY(-4px);box-shadow:var(--shadow-md)}
.item-card.is-resolved{opacity:.6;filter:grayscale(.3)}
.card-found{border-top:3px solid var(--found)}
.card-lost{border-top:3px solid var(--lost)}
.card-resolved{border-top:3px solid var(--resolved)}
.card-match{border-top:3px solid var(--match);box-shadow:0 0 0 2px var(--match-bg)}
.status-badge{position:absolute;top:11px;right:11px;font-size:.72rem;font-weight:700;padding:4px 10px;border-radius:100px;z-index:1}
.card-found .status-badge{background:var(--found-bg);color:var(--found);border:1px solid #a8dfc8}
.card-lost  .status-badge{background:var(--lost-bg);color:var(--lost);border:1px solid #f5c5ae}
.card-resolved .status-badge{background:var(--resolved-bg);color:var(--resolved);border:1px solid #ccc8f0}
.match-banner{background:var(--match-bg);border-bottom:1px solid #fcd470;padding:7px 14px;font-size:.78rem;font-weight:600;color:var(--match);display:flex;align-items:center;gap:6px}
.card-img{height:108px;background:var(--bg);display:flex;align-items:center;justify-content:center;border-bottom:1px solid var(--border);font-size:2.5rem;opacity:.65;overflow:hidden}
.card-img img{width:100%;height:100%;object-fit:cover;opacity:1}
.card-body{padding:14px 15px;display:flex;flex-direction:column;gap:7px;flex:1}
.card-meta{display:flex;justify-content:space-between;align-items:center}
.card-cat{font-size:.7rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--text-secondary);background:var(--bg);padding:3px 9px;border-radius:100px;border:1px solid var(--border)}
.card-date{font-size:.73rem;color:var(--text-secondary)}
.card-title{font-family:'Syne',sans-serif;font-size:1rem;font-weight:700;line-height:1.3}
.card-desc{font-size:.85rem;color:var(--text-secondary);line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.card-contact{margin-top:auto;padding-top:10px;border-top:1px solid var(--border);display:flex;align-items:center;gap:6px;font-size:.81rem}
.card-actions{padding:0 14px 12px;display:flex;gap:8px}
.btn-resolve{flex:1;padding:8px;border-radius:var(--radius-sm);border:none;font-size:.8rem;font-weight:600;font-family:inherit;background:var(--resolved-bg);color:var(--resolved);transition:background .2s}
.btn-resolve:hover{background:var(--resolved);color:#fff}
.btn-contact{flex:1;padding:8px;border-radius:var(--radius-sm);border:1px solid var(--border);font-size:.8rem;font-weight:600;font-family:inherit;background:transparent;color:var(--text-secondary);transition:all .2s}
.btn-contact:hover{border-color:var(--found);color:var(--found)}

/* â•â• MATCH SECTION â•â• */
.match-section{background:var(--match-bg);border:1px solid #fcd470;border-radius:var(--radius);padding:20px 22px;margin-bottom:28px}
.match-section-title{font-family:'Syne',sans-serif;font-size:1rem;font-weight:800;color:var(--match);margin-bottom:14px;display:flex;align-items:center;gap:8px}

/* â•â• INLINE FORM â•â• */
.inline-form{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:26px;box-shadow:var(--shadow-sm);display:flex;flex-direction:column;gap:16px}
.inline-form h3{font-family:'Syne',sans-serif;font-size:1.05rem;font-weight:700;padding-bottom:14px;border-bottom:1px solid var(--border)}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.form-group{display:flex;flex-direction:column;gap:5px}
.form-group label{font-size:.78rem;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.4px}
.form-group input,.form-group textarea,.form-group select{padding:10px 13px;border:1px solid var(--border);border-radius:var(--radius-sm);font-size:.93rem;font-family:inherit;color:var(--text-primary);background:var(--bg);transition:border-color .2s;outline:none}
.form-group input:focus,.form-group textarea:focus,.form-group select:focus{border-color:var(--accent);background:#fff}
.form-group textarea{resize:vertical}
.err{font-size:.78rem;color:#e53e3e}
.upload-zone{border:2px dashed var(--border);border-radius:var(--radius-sm);padding:22px;text-align:center;cursor:pointer;position:relative;transition:border-color .2s,background .2s;background:var(--bg);color:var(--text-secondary)}
.upload-zone:hover{border-color:var(--accent);background:#fff9f7}
.upload-icon{font-size:1.7rem;display:block;margin-bottom:5px}
.upload-zone p{font-size:.83rem}
.file-input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.img-preview{max-height:100px;border-radius:6px;object-fit:cover}
.form-actions{display:flex;justify-content:flex-end;gap:10px;padding-top:4px}
.btn-primary{background:var(--accent);color:#fff;border:none;padding:11px 28px;border-radius:100px;font-size:.93rem;font-weight:600;transition:background .2s,transform .1s}
.btn-primary:hover{background:var(--accent-hover);transform:translateY(-1px)}
.btn-primary:disabled{opacity:.6;cursor:not-allowed;transform:none}
.btn-secondary{background:transparent;color:var(--text-secondary);border:1px solid var(--border);padding:11px 20px;border-radius:100px;font-size:.93rem;font-weight:500;transition:all .2s}
.btn-secondary:hover{border-color:var(--text-secondary);color:var(--text-primary)}

/* â•â• EMPTY & LOADING â•â• */
.empty-state{text-align:center;padding:60px 20px;color:var(--text-secondary)}
.empty-icon{font-size:2.8rem;display:block;margin-bottom:12px}
.empty-state h3{font-family:'Syne',sans-serif;font-size:1.15rem;color:var(--text-primary);margin-bottom:6px}
.loading-state{text-align:center;padding:60px 20px;color:var(--text-secondary);font-size:.9rem}
.spinner{width:32px;height:32px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .7s linear infinite;margin:0 auto 12px}
@keyframes spin{to{transform:rotate(360deg)}}

/* â•â• TOAST â•â• */
.toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%) translateY(20px);background:#1a1714;color:#fff;padding:13px 24px;border-radius:100px;font-size:.88rem;font-weight:500;opacity:0;transition:all .3s;z-index:9999;pointer-events:none;white-space:nowrap}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.toast.error{background:#c53030}

/* â•â• DIVIDER â•â• */
.divider{height:1px;background:var(--border);margin:36px 0}

@media(max-width:580px){
  .choice-cards{grid-template-columns:1fr;max-width:340px}
  .form-row{grid-template-columns:1fr}
  .page-hero{flex-direction:column;text-align:center;padding:22px 18px}
  .search-bar{flex-direction:column;align-items:stretch}
  .status-pills{justify-content:center}
  .navbar{padding:14px 18px}
  .inline-form{padding:18px}
  .page-wrap{padding:0 16px 48px}
}
</style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar">
  <div class="navbar-brand" onclick="showPage('welcome')">
    <span>ğŸ”</span>
    <span class="navbar-title">MEC Lost &amp; Found</span>
  </div>
  <div class="nav-right" id="navRight"></div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• WELCOME â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page active" id="page-welcome">
  <div class="welcome-wrap">
    <div class="welcome-badge">ğŸ“ Model Engineering College</div>
    <h1>Lost something?<br/>Or found something?<br/><span>We've got you.</span></h1>
    <p class="subtitle">MEC's official lost &amp; found board â€” helping MECians reconnect with their belongings.</p>
    <div class="choice-cards">
      <div class="choice-card found-card" onclick="showPage('found')">
        <div class="choice-icon">ğŸ‰</div>
        <h2>I Found Something</h2>
        <p>Picked up something on campus? Post it so the owner can find you.</p>
        <button class="choice-cta">Post a Found Item</button>
      </div>
      <div class="choice-card lost-card" onclick="showPage('lost')">
        <div class="choice-icon">ğŸ˜Ÿ</div>
        <h2>I Lost Something</h2>
        <p>Misplaced something? Report it and we'll check if someone already found it.</p>
        <button class="choice-cta">Report a Lost Item</button>
      </div>
    </div>
    <div class="welcome-footer">
      <button onclick="showPage('all')">ğŸ—‚ Browse all items</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• FOUND PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-found">
  <div class="page-wrap">
    <div class="page-hero found-hero">
      <div class="hero-icon">ğŸ‰</div>
      <div>
        <h2>Post a Found Item</h2>
        <p>Fill in what you found. If it matches a lost report, both parties will be notified instantly.</p>
      </div>
    </div>

    <form class="inline-form" id="foundForm" onsubmit="submitFoundForm(event)">
      <h3>ğŸ“‹ What did you find?</h3>
      <div class="form-row">
        <div class="form-group">
          <label>Item Title *</label>
          <input id="fTitle" placeholder="e.g. Black AirPods Pro"/>
          <span class="err" id="fErrTitle"></span>
        </div>
        <div class="form-group">
          <label>Category</label>
          <select id="fCategory">
            <option>Electronics</option><option>ID Cards</option><option>Books</option><option>Others</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>Description *</label>
        <textarea id="fDesc" rows="3" placeholder="Describe the item â€” colour, brand, where you found it..."></textarea>
        <span class="err" id="fErrDesc"></span>
      </div>
      <div class="form-group">
        <label>Your Contact Info *</label>
        <input id="fContact" placeholder="Your email or phone number"/>
        <span class="err" id="fErrContact"></span>
      </div>
      <div class="form-group">
        <label>Upload Image (optional)</label>
        <div class="upload-zone" id="fUpload">
          <span class="upload-icon">ğŸ“·</span>
          <p>Click or drag a photo</p>
          <input type="file" accept="image/*" class="file-input" id="fImageFile" onchange="handleImg('fUpload',event)"/>
        </div>
      </div>
      <div class="form-actions">
        <button type="button" class="btn-secondary" onclick="showPage('welcome')">Cancel</button>
        <button type="submit" class="btn-primary" id="fSubmitBtn">Post Found Item</button>
      </div>
    </form>

    <div id="foundMatchAlert" style="display:none;margin-top:24px"></div>

    <div class="divider"></div>

    <div class="search-bar">
      <div class="search-input-wrap">
        <span class="si">ğŸ”</span>
        <input type="text" class="search-input" placeholder="Search found items..." id="fSearch" oninput="renderFoundList()"/>
      </div>
      <select class="filter-select" id="fCatFilter" onchange="renderFoundList()">
        <option>All</option><option>Electronics</option><option>ID Cards</option><option>Books</option><option>Others</option>
      </select>
    </div>
    <div class="section-label">All Found Items <span class="count-badge" id="fCount"></span></div>
    <div class="items-grid" id="foundGrid"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• LOST PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-lost">
  <div class="page-wrap" style="max-width:780px">
    <div class="page-hero lost-hero">
      <div class="hero-icon">ğŸ˜Ÿ</div>
      <div>
        <h2>Report a Lost Item</h2>
        <p>Describe what you lost. We'll instantly check if someone has already found it.</p>
      </div>
    </div>

    <div id="lostMatchAlert" style="display:none;margin-bottom:20px"></div>

    <form class="inline-form" id="lostForm" onsubmit="submitLostForm(event)">
      <h3>ğŸ“‹ What did you lose?</h3>
      <div class="form-row">
        <div class="form-group">
          <label>Item Title *</label>
          <input id="lTitle" placeholder="e.g. Blue Hydro Flask bottle"/>
          <span class="err" id="lErrTitle"></span>
        </div>
        <div class="form-group">
          <label>Category</label>
          <select id="lCategory">
            <option>Electronics</option><option>ID Cards</option><option>Books</option><option>Others</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>Description *</label>
        <textarea id="lDesc" rows="3" placeholder="Colour, brand, distinguishing marks, where you last had it..."></textarea>
        <span class="err" id="lErrDesc"></span>
      </div>
      <div class="form-group">
        <label>Your Contact Info *</label>
        <input id="lContact" placeholder="Your email or phone number"/>
        <span class="err" id="lErrContact"></span>
      </div>
      <div class="form-group">
        <label>Upload Image (optional)</label>
        <div class="upload-zone" id="lUpload">
          <span class="upload-icon">ğŸ“·</span>
          <p>Click or drag a photo</p>
          <input type="file" accept="image/*" class="file-input" id="lImageFile" onchange="handleImg('lUpload',event)"/>
        </div>
      </div>
      <div class="form-actions">
        <button type="button" class="btn-secondary" onclick="showPage('welcome')">Cancel</button>
        <button type="submit" class="btn-primary" id="lSubmitBtn">Submit Lost Report</button>
      </div>
    </form>

    <div id="lostListSection" style="display:none">
      <div class="divider"></div>
      <div class="section-label">ğŸ˜Ÿ Active Lost Reports <span class="count-badge" id="lCount"></span></div>
      <div class="items-grid" id="lostGrid"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• ALL ITEMS PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-all">
  <div class="page-wrap">
    <div class="page-hero all-hero">
      <div class="hero-icon">ğŸ—‚ï¸</div>
      <div>
        <h2>All Items</h2>
        <p>Browse every lost and found post on campus. Filter by status or category.</p>
      </div>
    </div>

    <div id="allMatchSection" style="display:none"></div>

    <div class="search-bar">
      <div class="search-input-wrap">
        <span class="si">ğŸ”</span>
        <input type="text" class="search-input" placeholder="Search all items..." id="allSearch" oninput="renderAll()"/>
      </div>
      <select class="filter-select" id="allCatFilter" onchange="renderAll()">
        <option>All</option><option>Electronics</option><option>ID Cards</option><option>Books</option><option>Others</option>
      </select>
      <div class="status-pills">
        <button class="spill active" onclick="setAllStatus('All',this)">All</button>
        <button class="spill" onclick="setAllStatus('Found',this)">ğŸ‰ Found</button>
        <button class="spill" onclick="setAllStatus('Lost',this)">ğŸ˜Ÿ Lost</button>
        <button class="spill" onclick="setAllStatus('Resolved',this)">âœ… Resolved</button>
      </div>
    </div>

    <div class="section-label">Items <span class="count-badge" id="allCount"></span></div>
    <div class="items-grid" id="allGrid"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIG â€” change BASE_URL to match your backend
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const BASE_URL = 'https://lost-and-found-aep9.onrender.com';
const API      = BASE_URL + '/api/items';

const ICONS = { Electronics:'ğŸ’»', 'ID Cards':'ğŸªª', Books:'ğŸ“š', Others:'ğŸ“¦' };

/* â”€â”€ In-memory cache (populated from DB) â”€â”€ */
let foundItems = [];
let lostItems  = [];
let allStatusFilter = 'All';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   API HELPERS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/** Fetch all items from MongoDB and split into found/lost arrays */
async function loadAllItems() {
  try {
    const res = await fetch(API);
    if (!res.ok) throw new Error('Network error');
    const items = await res.json();
    foundItems = items.filter(i => i.status === 'Found' || (i.status === 'Resolved' && i._originalStatus === 'Found'));
    lostItems  = items.filter(i => i.status === 'Lost'  || (i.status === 'Resolved' && i._originalStatus === 'Lost'));
    // Simple split: if resolved, decide by absence in found â€” just keep all in both for matching
    foundItems = items.filter(i => ['Found','Resolved'].includes(i.status) && i.status !== 'Lost');
    lostItems  = items.filter(i => ['Lost', 'Resolved'].includes(i.status) && i.status !== 'Found');
    // Actually cleanest: backend stores status as Lost/Found/Resolved
    // Re-split properly:
    foundItems = items.filter(i => i.status === 'Found');
    lostItems  = items.filter(i => i.status === 'Lost');
    // Keep resolved items in both for display in All page â€” store separately
    window._allItems = items;
  } catch(err) {
    console.error('Failed to load items:', err);
    showToast('âš ï¸ Could not connect to server', true);
  }
}

/** POST a new item (with optional image) */
async function postItem(formData) {
  const res = await fetch(API, { method:'POST', body: formData });
  if (!res.ok) throw new Error(await res.text());
  return res.json();
}

/** PATCH an item's status to Resolved */
async function resolveItem(id) {
  const res = await fetch(`${API}/${id}`, {
    method: 'PATCH',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ status: 'Resolved' })
  });
  if (!res.ok) throw new Error(await res.text());
  return res.json();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  setNavbar(name);
  await loadAllItems();
  if (name === 'found') renderFoundList();
  if (name === 'lost')  renderLostList();
  if (name === 'all')   { renderAll(); renderAllMatches(); }
}

function setNavbar(name) {
  const nav = document.getElementById('navRight');
  const tags = {
    found: `<span class="nav-tag found">ğŸ‰ Found</span>`,
    lost:  `<span class="nav-tag lost">ğŸ˜Ÿ Lost</span>`,
    all:   `<span class="nav-tag all">ğŸ—‚ All Items</span>`
  };
  if (name === 'welcome') { nav.innerHTML=''; return; }
  nav.innerHTML = `${tags[name]||''}<button class="back-btn" onclick="showPage('welcome')">â† Home</button>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CROSS-MATCH ENGINE (client-side, uses cached data)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function findMatches(item, pool) {
  const words = (item.title + ' ' + item.description)
    .toLowerCase().split(/\W+/).filter(w => w.length > 3);
  return pool.filter(p => {
    if (p.status === 'Resolved') return false;
    if (p.category !== item.category) return false;
    const pWords = (p.title + ' ' + p.description).toLowerCase();
    return words.some(w => pWords.includes(w));
  });
}

function getAllMatches() {
  const pairs = []; const seen = new Set();
  foundItems.filter(f => f.status==='Found').forEach(f => {
    findMatches(f, lostItems.filter(l => l.status==='Lost')).forEach(l => {
      const key = `${f._id}-${l._id}`;
      if (!seen.has(key)) { seen.add(key); pairs.push({ found:f, lost:l }); }
    });
  });
  return pairs;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARD HTML  (uses _id from MongoDB)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function imgContent(item) {
  if (item.image) {
    return `<img src="${BASE_URL}/uploads/${item.image}" alt="${item.title}" loading="lazy"/>`;
  }
  return ICONS[item.category] || 'ğŸ“¦';
}

function formatDate(d) {
  return d ? new Date(d).toISOString().split('T')[0] : '';
}

function cardHTML(item) {
  const isResolved = item.status === 'Resolved';
  const statusLabel = item.status==='Found' ? 'ğŸ‰ Found' : item.status==='Lost' ? 'ğŸ˜Ÿ Lost' : 'âœ… Returned';
  const cardClass   = isResolved ? 'card-resolved' : item.status==='Found' ? 'card-found' : 'card-lost';
  const resolveBtn  = !isResolved
    ? `<div class="card-actions">
         <button class="btn-resolve" onclick="markResolved('${item._id}')">âœ… Mark as Returned</button>
       </div>`
    : `<div class="card-actions">
         <button class="btn-contact" style="cursor:default;opacity:.6">âœ… Item returned</button>
       </div>`;
  return `
    <div class="item-card ${cardClass} ${isResolved?'is-resolved':''}">
      <div class="status-badge">${statusLabel}</div>
      <div class="card-img">${imgContent(item)}</div>
      <div class="card-body">
        <div class="card-meta">
          <span class="card-cat">${item.category}</span>
          <span class="card-date">${formatDate(item.date)}</span>
        </div>
        <h3 class="card-title">${item.title}</h3>
        <p class="card-desc">${item.description}</p>
        <div class="card-contact">ğŸ“¬ <a href="mailto:${item.contact}">${item.contact}</a></div>
      </div>
      ${resolveBtn}
    </div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESOLVE ACTIONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function markResolved(id) {
  try {
    await resolveItem(id);
    await loadAllItems();
    refresh();
    showToast('âœ… Item marked as returned!');
  } catch(e) {
    showToast('âš ï¸ Failed to update item', true);
  }
}

async function resolveMatch(foundId, lostId) {
  try {
    await Promise.all([resolveItem(foundId), resolveItem(lostId)]);
    await loadAllItems();
    refresh();
    showToast('ğŸ‰ Item marked as returned to owner!');
  } catch(e) {
    showToast('âš ï¸ Failed to update items', true);
  }
}

function refresh() {
  renderFoundList(); renderLostList(); renderAll(); renderAllMatches();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER FUNCTIONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function loadingHTML() {
  return `<div class="loading-state"><div class="spinner"></div>Loading from databaseâ€¦</div>`;
}

function renderFoundList() {
  const s   = (document.getElementById('fSearch')||{}).value||'';
  const cat = (document.getElementById('fCatFilter')||{}).value||'All';
  const list = foundItems.filter(i =>
    i.title.toLowerCase().includes(s.toLowerCase()) && (cat==='All' || i.category===cat)
  );
  const el = document.getElementById('foundGrid');
  if (!el) return;
  document.getElementById('fCount').textContent = `(${list.length})`;
  el.innerHTML = list.length ? list.map(cardHTML).join('') :
    `<div class="empty-state"><span class="empty-icon">ğŸ—‚ï¸</span><h3>No found items yet</h3><p>Be the first to post one above.</p></div>`;
}

function renderLostList() {
  const section = document.getElementById('lostListSection');
  if (!section) return;
  const active = lostItems.filter(i => i.status !== 'Resolved');
  if (!lostItems.length) { section.style.display='none'; return; }
  section.style.display = 'block';
  document.getElementById('lCount').textContent = `(${active.length} active)`;
  document.getElementById('lostGrid').innerHTML = lostItems.length
    ? lostItems.map(cardHTML).join('')
    : `<div class="empty-state"><span class="empty-icon">ğŸ—‚ï¸</span><h3>No lost reports yet</h3></div>`;
}

function setAllStatus(s, btn) {
  allStatusFilter = s;
  document.querySelectorAll('.spill').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderAll();
}

function renderAll() {
  const s   = (document.getElementById('allSearch')||{}).value||'';
  const cat = (document.getElementById('allCatFilter')||{}).value||'All';
  const all = window._allItems || [...foundItems, ...lostItems];
  const list = all.filter(i =>
    i.title.toLowerCase().includes(s.toLowerCase()) &&
    (cat==='All' || i.category===cat) &&
    (allStatusFilter==='All' || i.status===allStatusFilter)
  );
  const el = document.getElementById('allGrid');
  if (!el) return;
  document.getElementById('allCount').textContent = `(${list.length})`;
  el.innerHTML = list.length ? list.map(cardHTML).join('') :
    `<div class="empty-state"><span class="empty-icon">ğŸ—‚ï¸</span><h3>Nothing here</h3><p>Try adjusting your filters.</p></div>`;
}

function matchSectionHTML(pairs) {
  if (!pairs.length) return '';
  return `
    <div class="match-section">
      <div class="match-section-title">ğŸ”— ${pairs.length} Potential Match${pairs.length>1?'es':''} Found!</div>
      <div class="items-grid">
        ${pairs.map(({found,lost}) => `
          <div class="item-card card-match">
            <div class="match-banner">ğŸ”— Possible match!</div>
            <div class="card-img">${imgContent(found)}</div>
            <div class="card-body">
              <div class="card-meta"><span class="card-cat">${found.category}</span><span class="card-date">${formatDate(found.date)}</span></div>
              <h3 class="card-title">Found: ${found.title}</h3>
              <p class="card-desc" style="color:var(--found);font-weight:600">Finder: ${found.contact}</p>
              <div style="height:8px"></div>
              <h3 class="card-title">Lost: ${lost.title}</h3>
              <p class="card-desc" style="color:var(--lost);font-weight:600">Owner: ${lost.contact}</p>
            </div>
            <div class="card-actions">
              <button class="btn-contact" onclick="resolveMatch('${found._id}','${lost._id}')">âœ… Mark as Returned</button>
            </div>
          </div>`).join('')}
      </div>
    </div>`;
}

function renderAllMatches() {
  const el = document.getElementById('allMatchSection');
  if (!el) return;
  const pairs = getAllMatches();
  if (!pairs.length) { el.style.display='none'; return; }
  el.style.display = 'block';
  el.innerHTML = matchSectionHTML(pairs);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM SUBMISSIONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function submitFoundForm(e) {
  e.preventDefault();
  const title   = document.getElementById('fTitle').value.trim();
  const desc    = document.getElementById('fDesc').value.trim();
  const contact = document.getElementById('fContact').value.trim();
  let ok = true;
  if (!title)   { document.getElementById('fErrTitle').textContent='Required.';   ok=false; } else { document.getElementById('fErrTitle').textContent=''; }
  if (!desc)    { document.getElementById('fErrDesc').textContent='Required.';    ok=false; } else { document.getElementById('fErrDesc').textContent=''; }
  if (!contact) { document.getElementById('fErrContact').textContent='Required.'; ok=false; } else { document.getElementById('fErrContact').textContent=''; }
  if (!ok) return;

  const btn = document.getElementById('fSubmitBtn');
  btn.disabled = true; btn.textContent = 'Postingâ€¦';

  const form = new FormData();
  form.append('title',       title);
  form.append('description', desc);
  form.append('contact',     contact);
  form.append('category',    document.getElementById('fCategory').value);
  form.append('status',      'Found');
  const imgFile = document.getElementById('fImageFile').files[0];
  if (imgFile) form.append('image', imgFile);

  try {
    const newItem = await postItem(form);
    await loadAllItems();

    // Check for matches in freshly loaded lost items
    const matches = findMatches(newItem, lostItems.filter(l => l.status==='Lost'));
    const alertEl = document.getElementById('foundMatchAlert');
    if (matches.length) {
      alertEl.style.display = 'block';
      alertEl.innerHTML = `
        <div class="match-section">
          <div class="match-section-title">ğŸ”— Possible match with a lost report!</div>
          <p style="font-size:.88rem;color:var(--text-secondary);margin-bottom:14px">Someone may have already reported this item lost. Contact them directly!</p>
          <div class="items-grid">${matches.map(m=>`
            <div class="item-card card-lost">
              <div class="status-badge">ğŸ˜Ÿ Lost Report</div>
              <div class="card-img">${imgContent(m)}</div>
              <div class="card-body">
                <div class="card-meta"><span class="card-cat">${m.category}</span><span class="card-date">${formatDate(m.date)}</span></div>
                <h3 class="card-title">${m.title}</h3>
                <p class="card-desc">${m.description}</p>
                <div class="card-contact">ğŸ“¬ <a href="mailto:${m.contact}">${m.contact}</a></div>
              </div>
              <div class="card-actions">
                <button class="btn-resolve" onclick="resolveMatch('${newItem._id}','${m._id}')">âœ… Mark as Returned</button>
              </div>
            </div>`).join('')}
          </div>
        </div>`;
      showToast('ğŸ”— Possible match found! Check below.');
    } else {
      alertEl.style.display = 'none';
      showToast('âœ… Found item posted successfully!');
    }

    // Reset form
    document.getElementById('fTitle').value   = '';
    document.getElementById('fDesc').value    = '';
    document.getElementById('fContact').value = '';
    resetUpload('fUpload');
    renderFoundList();
  } catch(err) {
    showToast('âš ï¸ Failed to post item: ' + err.message, true);
  } finally {
    btn.disabled = false; btn.textContent = 'Post Found Item';
  }
}

async function submitLostForm(e) {
  e.preventDefault();
  const title   = document.getElementById('lTitle').value.trim();
  const desc    = document.getElementById('lDesc').value.trim();
  const contact = document.getElementById('lContact').value.trim();
  let ok = true;
  if (!title)   { document.getElementById('lErrTitle').textContent='Required.';   ok=false; } else { document.getElementById('lErrTitle').textContent=''; }
  if (!desc)    { document.getElementById('lErrDesc').textContent='Required.';    ok=false; } else { document.getElementById('lErrDesc').textContent=''; }
  if (!contact) { document.getElementById('lErrContact').textContent='Required.'; ok=false; } else { document.getElementById('lErrContact').textContent=''; }
  if (!ok) return;

  const btn = document.getElementById('lSubmitBtn');
  btn.disabled = true; btn.textContent = 'Submittingâ€¦';

  const form = new FormData();
  form.append('title',       title);
  form.append('description', desc);
  form.append('contact',     contact);
  form.append('category',    document.getElementById('lCategory').value);
  form.append('status',      'Lost');
  const imgFile = document.getElementById('lImageFile').files[0];
  if (imgFile) form.append('image', imgFile);

  try {
    const newItem = await postItem(form);
    await loadAllItems();

    const matches = findMatches(newItem, foundItems.filter(f => f.status==='Found'));
    const alertEl = document.getElementById('lostMatchAlert');
    if (matches.length) {
      alertEl.style.display = 'block';
      alertEl.innerHTML = `
        <div class="match-section">
          <div class="match-section-title">ğŸ‰ Good news â€” someone may have found your item!</div>
          <p style="font-size:.88rem;color:var(--text-secondary);margin-bottom:14px">Contact the finder directly to confirm it's yours.</p>
          <div class="items-grid">${matches.map(m=>`
            <div class="item-card card-found">
              <div class="status-badge">ğŸ‰ Found</div>
              <div class="card-img">${imgContent(m)}</div>
              <div class="card-body">
                <div class="card-meta"><span class="card-cat">${m.category}</span><span class="card-date">${formatDate(m.date)}</span></div>
                <h3 class="card-title">${m.title}</h3>
                <p class="card-desc">${m.description}</p>
                <div class="card-contact">ğŸ“¬ <a href="mailto:${m.contact}">${m.contact}</a></div>
              </div>
              <div class="card-actions">
                <button class="btn-resolve" onclick="resolveMatch('${m._id}','${newItem._id}')">âœ… Mark as Returned</button>
              </div>
            </div>`).join('')}
          </div>
        </div>`;
      showToast('ğŸ‰ A possible match was found!');
    } else {
      alertEl.style.display = 'none';
      showToast("âœ… Lost report posted. We'll flag any matches!");
    }

    document.getElementById('lTitle').value   = '';
    document.getElementById('lDesc').value    = '';
    document.getElementById('lContact').value = '';
    resetUpload('lUpload');
    renderLostList();
  } catch(err) {
    showToast('âš ï¸ Failed to submit report: ' + err.message, true);
  } finally {
    btn.disabled = false; btn.textContent = 'Submit Lost Report';
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function handleImg(zoneId, e) {
  const file = e.target.files[0];
  if (file) {
    const url = URL.createObjectURL(file);
    const inputId = zoneId === 'fUpload' ? 'fImageFile' : 'lImageFile';
    document.getElementById(zoneId).innerHTML =
      `<img src="${url}" class="img-preview" alt="preview"/>
       <input type="file" accept="image/*" class="file-input" id="${inputId}" onchange="handleImg('${zoneId}',event)"/>`;
  }
}

function resetUpload(zoneId) {
  const inputId = zoneId === 'fUpload' ? 'fImageFile' : 'lImageFile';
  document.getElementById(zoneId).innerHTML =
    `<span class="upload-icon">ğŸ“·</span><p>Click or drag a photo</p>
     <input type="file" accept="image/*" class="file-input" id="${inputId}" onchange="handleImg('${zoneId}',event)"/>`;
}

function showToast(msg, isError=false) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast' + (isError ? ' error' : '');
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3500);
}
</script>

</body>

</html>
